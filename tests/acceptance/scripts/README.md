# éªŒæ”¶æµ‹è¯•è„šæœ¬

éªŒæ”¶æµ‹è¯•è¿è¡Œè„šæœ¬ï¼Œç”¨äºæ‰§è¡ŒåŸºäºé…ç½®æ–‡ä»¶çš„ CLI éªŒæ”¶æµ‹è¯•å¹¶ç”Ÿæˆè¯¦ç»†æ—¥å¿—ã€‚

## è„šæœ¬åˆ—è¡¨

### æ ¸å¿ƒéªŒæ”¶æµ‹è¯•è„šæœ¬

- `run_acceptance_infra.sh` - åŸºç¡€è®¾æ–½éªŒæ”¶æµ‹è¯•
- `run_acceptance_security.sh` - å®‰å…¨é…ç½®éªŒæ”¶æµ‹è¯•
- `run_acceptance_data_collector.sh` - æ•°æ®é‡‡é›†å™¨éªŒæ”¶æµ‹è¯•
- `run_acceptance_monitor.sh` - ç›‘æ§ç³»ç»ŸéªŒæ”¶æµ‹è¯•
- `run_acceptance_freqtrade.sh` - Freqtrade äº¤æ˜“æœºå™¨äººéªŒæ”¶æµ‹è¯• ğŸ†•
- `run_acceptance_lifecycle.sh` - CLI ç”Ÿå‘½å‘¨æœŸå·¥ä½œæµéªŒæ”¶æµ‹è¯•
- `run_acceptance_comprehensive.sh` - ç»¼åˆç¯å¢ƒéƒ¨ç½²éªŒæ”¶æµ‹è¯• â­ **æœ€é‡è¦**
- `run_all_acceptance.sh` - éªŒæ”¶æµ‹è¯•å¥—ä»¶ä¸»è¿è¡Œå™¨ â­

## ä½¿ç”¨æ–¹æ³•

### è¿è¡Œå•ä¸ªéªŒæ”¶æµ‹è¯•

```bash
# åŸºç¡€è®¾æ–½éªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_infra.sh

# å®‰å…¨é…ç½®éªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_security.sh

# æ•°æ®é‡‡é›†å™¨éªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_data_collector.sh

# ç›‘æ§ç³»ç»ŸéªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_monitor.sh

# Freqtrade äº¤æ˜“æœºå™¨äººéªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_freqtrade.sh

# CLI ç”Ÿå‘½å‘¨æœŸéªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_acceptance_lifecycle.sh
```

### è¿è¡Œç»¼åˆéªŒæ”¶æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´ç¯å¢ƒéƒ¨ç½²éªŒæ”¶æµ‹è¯•ï¼ˆæœ€é‡è¦ï¼‰
./tests/acceptance/scripts/run_acceptance_comprehensive.sh

# è¿è¡Œæ‰€æœ‰éªŒæ”¶æµ‹è¯•
./tests/acceptance/scripts/run_all_acceptance.sh
```

## æ—¥å¿—æ–‡ä»¶

æµ‹è¯•æ—¥å¿—ä¿å­˜åœ¨ `tests/acceptance/logs/` ç›®å½•ï¼š

- `{test_name}_{timestamp}.log` - å®Œæ•´æµ‹è¯•æ—¥å¿—
- `{test_name}_{timestamp}_errors.txt` - é”™è¯¯æå–
- `{test_name}_{timestamp}_summary.txt` - æµ‹è¯•æ‘˜è¦

## å‰ç½®æ¡ä»¶

1. **æ¿€æ´» conda ç¯å¢ƒ**:
   ```bash
   conda activate quants-infra
   ```

2. **é…ç½® AWS å‡­è¯**
   - æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
     ```bash
     cat ~/.aws/credentials
     [default]
     aws_access_key_id = YOUR_KEY_ID
     aws_secret_access_key = YOUR_SECRET_KEY
     ```
   
   - æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡
     ```bash
     export AWS_ACCESS_KEY_ID=YOUR_KEY_ID
     export AWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY
     ```

3. **å®‰è£…é¡¹ç›®**:
   ```bash
   pip install -e .
   ```

4. **ç¡®ä¿ CLI å¯ç”¨**:
   ```bash
   quants-infra --help
   ```

## æµ‹è¯•æ—¶é—´

| æµ‹è¯•ç±»å‹ | é¢„è®¡æ—¶é—´ | é¢„è®¡æˆæœ¬ |
|---------|---------|---------|
| åŸºç¡€è®¾æ–½éªŒæ”¶æµ‹è¯• | 5-10 åˆ†é’Ÿ | < $0.01 |
| å®‰å…¨é…ç½®éªŒæ”¶æµ‹è¯• | 15-25 åˆ†é’Ÿ | < $0.02 |
| æ•°æ®é‡‡é›†å™¨éªŒæ”¶æµ‹è¯• | 10-15 åˆ†é’Ÿ | < $0.01 |
| ç›‘æ§ç³»ç»ŸéªŒæ”¶æµ‹è¯• | 10-15 åˆ†é’Ÿ | < $0.01 |
| Freqtrade äº¤æ˜“æœºå™¨äººéªŒæ”¶æµ‹è¯• | 20-30 åˆ†é’Ÿ | < $0.02 |
| CLI ç”Ÿå‘½å‘¨æœŸéªŒæ”¶æµ‹è¯• | 10-15 åˆ†é’Ÿ | < $0.01 |
| **ç»¼åˆç¯å¢ƒéƒ¨ç½²éªŒæ”¶æµ‹è¯•** | **20-30 åˆ†é’Ÿ** | **< $0.03** â­ |
| æ‰€æœ‰éªŒæ”¶æµ‹è¯• | 80-120 åˆ†é’Ÿ | < $0.12 |

## è„šæœ¬ç‰¹ç‚¹

æ‰€æœ‰éªŒæ”¶æµ‹è¯•è„šæœ¬åŒ…å«ï¼š
- âœ… è¯¦ç»†çš„ä¸­æ–‡æ—¥å¿—è¾“å‡º
- âœ… å‰ç½®æ¡ä»¶æ£€æŸ¥ï¼ˆconda ç¯å¢ƒã€AWS å‡­è¯ã€CLI å¯ç”¨æ€§ï¼‰
- âœ… æµ‹è¯•æ­¥éª¤è¯¦ç»†å±•ç¤º
- âœ… æˆæœ¬ä¼°ç®—æç¤º
- âœ… ç”¨æˆ·ç¡®è®¤æç¤º
- âœ… é”™è¯¯è‡ªåŠ¨æå–
- âœ… æµ‹è¯•æ‘˜è¦ç”Ÿæˆ
- âœ… å½©è‰²è¾“å‡ºæ”¯æŒ
- âœ… æ—¶é—´è·Ÿè¸ª
- âœ… å¿«é€Ÿå‘½ä»¤æç¤º

## ä¸ E2E æµ‹è¯•çš„åŒºåˆ«

| ç‰¹æ€§ | E2E æµ‹è¯• | éªŒæ”¶æµ‹è¯• |
|------|---------|---------|
| **ä½ç½®** | tests/e2e/scripts/ | tests/acceptance/scripts/ |
| **æ¥å£** | Python API ç›´æ¥è°ƒç”¨ | CLI å‘½ä»¤è¡Œæ¥å£ |
| **é…ç½®** | Python å­—å…¸ | YAML é…ç½®æ–‡ä»¶ |
| **ç„¦ç‚¹** | å†…éƒ¨ä»£ç å®ç° | ç”¨æˆ· CLI æ¥å£ |
| **æµ‹è¯•å¯¹è±¡** | Python ç±»å’Œå‡½æ•° | CLI å‘½ä»¤å’Œå‚æ•° |
| **ç›®çš„** | éªŒè¯ä»£ç æ­£ç¡®æ€§ | éªŒè¯ç”¨æˆ·ä½“éªŒ |

**E2E æµ‹è¯•**ï¼šéªŒè¯å†…éƒ¨ä»£ç å®ç°ï¼Œç›´æ¥è°ƒç”¨ Python APIï¼Œæµ‹è¯•ç±»å’Œå‡½æ•°ã€‚  
**éªŒæ”¶æµ‹è¯•**ï¼šéªŒè¯ç”¨æˆ·ä½¿ç”¨çš„ CLI æ¥å£ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ï¼Œæµ‹è¯•ç”¨æˆ·å·¥ä½œæµã€‚

## éªŒæ”¶æµ‹è¯•è¦†ç›–èŒƒå›´

### åŸºç¡€è®¾æ–½éªŒæ”¶æµ‹è¯• (test_config_infra.py)
- âœ… ä»é…ç½®æ–‡ä»¶åˆ›å»ºå®ä¾‹
- âœ… ä»é…ç½®æ–‡ä»¶æŸ¥è¯¢å®ä¾‹ä¿¡æ¯
- âœ… ä»é…ç½®æ–‡ä»¶ç®¡ç†å®ä¾‹ï¼ˆåœæ­¢/å¯åŠ¨/é‡å¯ï¼‰
- âœ… ä»é…ç½®æ–‡ä»¶é”€æ¯å®ä¾‹
- âœ… é™æ€ IP åˆ†é…å’Œç”Ÿå‘½å‘¨æœŸæµ‹è¯•
- âœ… é™æ€ IP æŒä¹…æ€§éªŒè¯ï¼ˆé‡å¯/åœæ­¢å¯åŠ¨ï¼‰

### å®‰å…¨é…ç½®éªŒæ”¶æµ‹è¯• (test_config_security.py)
- âœ… å®ä¾‹åˆ›å»ºå’ŒSSHè¿æ¥éªŒè¯
- âœ… åˆå§‹å®‰å…¨é…ç½®ï¼ˆç³»ç»Ÿæ›´æ–°ã€å·¥å…·å®‰è£…ï¼‰
- âœ… é˜²ç«å¢™é…ç½®ï¼ˆiptablesé»˜è®¤DROPç­–ç•¥ï¼‰
- âœ… SSH å®‰å…¨åŠ å›ºï¼ˆç«¯å£22â†’6677ï¼Œå¯†é’¥è®¤è¯ï¼‰
- âœ… fail2ban å®‰è£…å’Œé…ç½®
- âœ… å®‰å…¨éªŒè¯ï¼ˆå…¨é¢æ£€æŸ¥ï¼‰
- âœ… é˜²ç«å¢™è§„åˆ™æŒä¹…åŒ–éªŒè¯
- âœ… ç›‘å¬ç«¯å£éªŒè¯
- âœ… é…ç½®æ ‡è®°æ–‡ä»¶éªŒè¯
- âœ… ç³»ç»Ÿæ—¥å¿—è®¿é—®éªŒè¯
- âœ… æœåŠ¡ä¸“ç”¨å®‰å…¨é…ç½®
- âœ… CLI çŠ¶æ€å‘½ä»¤æµ‹è¯•
- âœ… å¤‡ä»½æ–‡ä»¶éªŒè¯

### æ•°æ®é‡‡é›†å™¨éªŒæ”¶æµ‹è¯• (test_config_data_collector.py)
- âœ… ä»é…ç½®æ–‡ä»¶éƒ¨ç½²æ•°æ®é‡‡é›†å™¨
- âœ… Docker å®¹å™¨éƒ¨ç½²
- âœ… äº¤æ˜“æ‰€è¿æ¥é…ç½®ï¼ˆGate.ioï¼‰
- âœ… äº¤æ˜“å¯¹é…ç½®ï¼ˆBTC-USDTï¼‰
- âœ… VPN é…ç½®
- âœ… æœåŠ¡å¥åº·æ£€æŸ¥

### ç›‘æ§ç³»ç»ŸéªŒæ”¶æµ‹è¯• (test_config_monitor.py)
- âœ… ä»é…ç½®æ–‡ä»¶éƒ¨ç½²å®Œæ•´ç›‘æ§æ ˆ
- âœ… Prometheus éƒ¨ç½²å’ŒéªŒè¯
- âœ… Grafana éƒ¨ç½²å’ŒéªŒè¯
- âœ… Alertmanager éƒ¨ç½²å’ŒéªŒè¯
- âœ… Node Exporter éƒ¨ç½²å’ŒéªŒè¯
- âœ… ç›‘æ§ç›®æ ‡æ·»åŠ 

### Freqtrade äº¤æ˜“æœºå™¨äººéªŒæ”¶æµ‹è¯• (test_config_freqtrade.py) ğŸ†•
- âœ… ä»é…ç½®æ–‡ä»¶éƒ¨ç½² Freqtrade äº¤æ˜“æœºå™¨äºº
- âœ… Docker ç¯å¢ƒé…ç½®
- âœ… äº¤æ˜“ç­–ç•¥éƒ¨ç½²ï¼ˆSampleStrategyï¼‰
- âœ… äº¤æ˜“æ‰€é…ç½®ï¼ˆBinanceï¼‰
- âœ… API æœåŠ¡éªŒè¯
- âœ… å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆé‡å¯ï¼‰
- âœ… æ—¥å¿—è·å–
- âœ… å¥åº·æ£€æŸ¥ï¼ˆå®¹å™¨çŠ¶æ€ã€é…ç½®æ–‡ä»¶ã€ç­–ç•¥æ–‡ä»¶ï¼‰

### CLI ç”Ÿå‘½å‘¨æœŸéªŒæ”¶æµ‹è¯• (test_config_cli_lifecycle.py)
- âœ… å®Œæ•´ç”Ÿå‘½å‘¨æœŸå·¥ä½œæµï¼š
  1. åˆ›å»ºå®ä¾‹
  2. åˆ—å‡ºå®ä¾‹
  3. è·å–å®ä¾‹ä¿¡æ¯
  4. åœæ­¢å®ä¾‹
  5. å¯åŠ¨å®ä¾‹
  6. é‡å¯å®ä¾‹
  7. é”€æ¯å®ä¾‹
- âœ… é…ç½®å‚æ•°å˜åŒ–æµ‹è¯•
- âœ… CLI å‚æ•°è¦†ç›–é…ç½®æ–‡ä»¶æµ‹è¯•
- âœ… æœ€å°é…ç½®æµ‹è¯•

### ç»¼åˆç¯å¢ƒéƒ¨ç½²éªŒæ”¶æµ‹è¯• (test_environment_deployment.py) â­

**è¿™æ˜¯æœ€é‡è¦çš„éªŒæ”¶æµ‹è¯•ï¼**

éªŒè¯å®Œæ•´ç”Ÿäº§çº§ç¯å¢ƒéƒ¨ç½²ï¼š
- âœ… Dry-run æ¨¡å¼ï¼ˆé¢„è§ˆéƒ¨ç½²è®¡åˆ’ï¼‰
- âœ… æœ€å°ç¯å¢ƒéƒ¨ç½²ï¼ˆå•å®ä¾‹ï¼‰
- âœ… **å®Œæ•´ç¯å¢ƒéƒ¨ç½²**ï¼š
  - å¤šå®ä¾‹åŸºç¡€è®¾æ–½ï¼ˆæ•°æ®é‡‡é›†å™¨ + ç›‘æ§æœåŠ¡å™¨ï¼‰
  - è·¨å®ä¾‹å®‰å…¨é…ç½®ï¼ˆé˜²ç«å¢™ã€SSHã€fail2banï¼‰
  - æœåŠ¡éƒ¨ç½²ï¼ˆæ•°æ®é‡‡é›†å™¨ + ç›‘æ§æ ˆï¼‰
  - ç«¯åˆ°ç«¯é›†æˆéªŒè¯
  - å•é…ç½®æ–‡ä»¶é©±åŠ¨
  - ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰éƒ¨ç½²

è¿™ä¸ªæµ‹è¯•æ¨¡æ‹ŸçœŸå®ç”Ÿäº§éƒ¨ç½²åœºæ™¯ï¼š
```bash
$ quants-infra deploy-environment --config production.yml
```

## é…ç½®æ–‡ä»¶ç¤ºä¾‹

éªŒæ”¶æµ‹è¯•åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œä¿å­˜åœ¨ï¼š
- `tests/acceptance/config/` - æµ‹è¯•è¿è¡Œæ—¶ç”Ÿæˆçš„ä¸´æ—¶é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶æ¨¡æ¿å‚è€ƒï¼š
- `config/examples/` - é¡¹ç›®é…ç½®æ–‡ä»¶ç¤ºä¾‹

## æœ€ä½³å®è·µ

1. **æŒ‰é¡ºåºè¿è¡Œ**ï¼š
   - å…ˆè¿è¡Œå•ä¸ªåŠŸèƒ½æµ‹è¯•ï¼ˆinfra, security, monitor, data-collectorï¼‰
   - å†è¿è¡Œç”Ÿå‘½å‘¨æœŸæµ‹è¯•ï¼ˆlifecycleï¼‰
   - æœ€åè¿è¡Œç»¼åˆæµ‹è¯•ï¼ˆcomprehensiveï¼‰

2. **èµ„æºæ¸…ç†**ï¼š
   - æ¯æ¬¡æµ‹è¯•å®Œæˆåä¼šè‡ªåŠ¨æ¸…ç† AWS èµ„æº
   - å¦‚æœæµ‹è¯•ä¸­æ–­ï¼Œè¯·æ‰‹åŠ¨æ¸…ç†æ®‹ç•™èµ„æº
   - ä½¿ç”¨ AWS Console æ£€æŸ¥ Lightsail å®ä¾‹

3. **æ—¥å¿—æŸ¥çœ‹**ï¼š
   - æµ‹è¯•å¤±è´¥æ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`cat tests/acceptance/logs/{test}_*_errors.txt`
   - æŸ¥çœ‹å®Œæ•´æ—¥å¿—ï¼š`cat tests/acceptance/logs/{test}_*_log`
   - æŸ¥çœ‹æ‘˜è¦ï¼š`cat tests/acceptance/logs/{test}_*_summary.txt`

4. **é…ç½®éªŒè¯**ï¼š
   - ä½¿ç”¨ `--dry-run` æ¨¡å¼é¢„è§ˆéƒ¨ç½²è®¡åˆ’
   - éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§
   - ç¡®è®¤èµ„æºé…é¢å……è¶³

5. **æˆæœ¬æ§åˆ¶**ï¼š
   - æ‰€æœ‰æµ‹è¯•ä½¿ç”¨æœ€å°å®ä¾‹è§„æ ¼ï¼ˆnano_3_0ï¼‰
   - æµ‹è¯•å®Œæˆåç«‹å³æ¸…ç†èµ„æº
   - å•æ¬¡æµ‹è¯•æˆæœ¬ < $0.03
   - å…¨éƒ¨æµ‹è¯•æˆæœ¬ < $0.10

6. **æ•…éšœæ’æŸ¥**ï¼š
   - æ£€æŸ¥ conda ç¯å¢ƒæ˜¯å¦æ¿€æ´»
   - æ£€æŸ¥ AWS å‡­è¯æ˜¯å¦æœ‰æ•ˆ
   - æ£€æŸ¥ CLI æ˜¯å¦æ­£ç¡®å®‰è£…
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯

## å¿«é€Ÿå¼€å§‹

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate quants-infra

# 2. æ£€æŸ¥ CLI
quants-infra --help

# 3. è¿è¡Œå•ä¸ªæµ‹è¯•
./tests/acceptance/scripts/run_acceptance_infra.sh

# 4. è¿è¡Œç»¼åˆæµ‹è¯•ï¼ˆæ¨èï¼‰
./tests/acceptance/scripts/run_acceptance_comprehensive.sh

# 5. æŸ¥çœ‹æµ‹è¯•æ—¥å¿—
ls -lht tests/acceptance/logs/ | head -10
```

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æç¤º**ï¼š
- éªŒæ”¶æµ‹è¯•ä¼šåˆ›å»ºçœŸå®çš„ AWS èµ„æºå¹¶äº§ç”Ÿè´¹ç”¨
- æµ‹è¯•ä½¿ç”¨æœ€å°é…ç½®ä»¥æ§åˆ¶æˆæœ¬ï¼ˆæ¯æ¬¡ < $0.03ï¼‰
- æµ‹è¯•ç»“æŸåä¼šè‡ªåŠ¨æ¸…ç†èµ„æº
- å¦‚æœæµ‹è¯•ä¸­æ–­ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥å¹¶æ¸…ç† AWS èµ„æº

âœ… **å®‰å…¨å»ºè®®**ï¼š
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡ŒéªŒæ”¶æµ‹è¯•
- ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯• AWS è´¦å·æˆ–å­è´¦å·
- é…ç½® AWS Budget Alerts ç›‘æ§æˆæœ¬
- å®šæœŸæ£€æŸ¥å¹¶æ¸…ç†æµ‹è¯•èµ„æº

ğŸ“ **åé¦ˆæ¸ é“**ï¼š
- æµ‹è¯•å¤±è´¥ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—å¹¶æäº¤ issue
- æ”¹è¿›å»ºè®®ï¼šåœ¨é¡¹ç›® issue ä¸­æå‡º
- æ–‡æ¡£é—®é¢˜ï¼šç›´æ¥ä¿®æ”¹ README.md æäº¤ PR
